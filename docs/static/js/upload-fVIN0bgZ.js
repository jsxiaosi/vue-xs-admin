var Pe=Object.defineProperty,Ce=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var se=(t,s,e)=>s in t?Pe(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,S=(t,s)=>{for(var e in s||(s={}))_e.call(s,e)&&se(t,e,s[e]);if(te)for(var e of te(s))Le.call(s,e)&&se(t,e,s[e]);return t},T=(t,s)=>Ce(t,Fe(s));var N=(t,s,e)=>new Promise((f,u)=>{var d=v=>{try{$(e.next(v))}catch(k){u(k)}},p=v=>{try{$(e.throw(v))}catch(k){u(k)}},$=v=>v.done?f(v.value):Promise.resolve(v.value).then(d,p);$((e=e.apply(t,s)).next())});import{dU as ee,dV as ve,bA as me,dW as K,dX as y,dY as Y,dZ as E,d as O,d_ as Ue,d$ as H,e0 as z,j as ye,A as Z,o as h,e as U,w as P,F as Se,u as n,M as g,dP as ge,c as L,N as b,bP as j,e1 as D,e2 as Te,h as _,t as ae,f as M,e3 as Oe,L as Be,e4 as De,e5 as je,e6 as Ae,e7 as qe,e8 as Ne,p as w,b as Me,b_ as He,e9 as I,cP as Ke,c2 as Q,ea as ne,bw as oe,bx as ze,eb as Ie,ec as Ve,ed as Xe,B as le,ee as We,H as Ge,d7 as Je,dr as Ye,q as re,m as ie,ef as Ze}from"./index-Mu6vz_nv.js";const he=Symbol("uploadContextKey"),Qe="ElUpload";class xe extends Error{constructor(s,e,f,u){super(s),this.name="UploadAjaxError",this.status=e,this.method=f,this.url=u}}function ue(t,s,e){let f;return e.response?f=`${e.response.error||e.response}`:e.responseText?f=`${e.responseText}`:f=`fail to ${s.method} ${t} ${e.status}`,new xe(f,e.status,s.method,t)}function et(t){const s=t.responseText||t.response;if(!s)return s;try{return JSON.parse(s)}catch(e){return s}}const tt=t=>{typeof XMLHttpRequest=="undefined"&&ee(Qe,"XMLHttpRequest is undefined");const s=new XMLHttpRequest,e=t.action;s.upload&&s.upload.addEventListener("progress",d=>{const p=d;p.percent=d.total>0?d.loaded/d.total*100:0,t.onProgress(p)});const f=new FormData;if(t.data)for(const[d,p]of Object.entries(t.data))ve(p)&&p.length?f.append(d,...p):f.append(d,p);f.append(t.filename,t.file,t.file.name),s.addEventListener("error",()=>{t.onError(ue(e,t,s))}),s.addEventListener("load",()=>{if(s.status<200||s.status>=300)return t.onError(ue(e,t,s));t.onSuccess(et(s))}),s.open(t.method,e,!0),t.withCredentials&&"withCredentials"in s&&(s.withCredentials=!0);const u=t.headers||{};if(u instanceof Headers)u.forEach((d,p)=>s.setRequestHeader(p,d));else for(const[d,p]of Object.entries(u))me(p)||s.setRequestHeader(d,String(p));return s.send(f),s},be=["text","picture","picture-card"];let st=1;const x=()=>Date.now()+st++,ke=K({action:{type:String,default:"#"},headers:{type:y(Object)},method:{type:String,default:"post"},data:{type:y([Object,Function,Promise]),default:()=>Y({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:y(Array),default:()=>Y([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:be,default:"text"},httpRequest:{type:y(Function),default:tt},disabled:Boolean,limit:Number}),at=K(T(S({},ke),{beforeUpload:{type:y(Function),default:E},beforeRemove:{type:y(Function)},onRemove:{type:y(Function),default:E},onChange:{type:y(Function),default:E},onPreview:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}})),nt=K({files:{type:y(Array),default:()=>Y([])},disabled:{type:Boolean,default:!1},handlePreview:{type:y(Function),default:E},listType:{type:String,values:be,default:"text"}}),ot={remove:t=>!!t},lt=["onKeydown"],rt=["src"],it=["onClick"],ut=["title"],dt=["onClick"],ct=["onClick"],ft=O({name:"ElUploadList"}),pt=O(T(S({},ft),{props:nt,emits:ot,setup(t,{emit:s}){const e=t,{t:f}=Ue(),u=H("upload"),d=H("icon"),p=H("list"),$=z(),v=ye(!1),k=Z(()=>[u.b("list"),u.bm("list",e.listType),u.is("disabled",e.disabled)]),R=m=>{s("remove",m)};return(m,l)=>(h(),U(He,{tag:"ul",class:g(n(k)),name:n(p).b()},{default:P(()=>[(h(!0),L(Se,null,Me(m.files,a=>(h(),L("li",{key:a.uid||a.name,class:g([n(u).be("list","item"),n(u).is(a.status),{focusing:v.value}]),tabindex:"0",onKeydown:ge(i=>!n($)&&R(a),["delete"]),onFocus:l[0]||(l[0]=i=>v.value=!0),onBlur:l[1]||(l[1]=i=>v.value=!1),onClick:l[2]||(l[2]=i=>v.value=!1)},[w(m.$slots,"default",{file:a},()=>[m.listType==="picture"||a.status!=="uploading"&&m.listType==="picture-card"?(h(),L("img",{key:0,class:g(n(u).be("list","item-thumbnail")),src:a.url,alt:""},null,10,rt)):b("v-if",!0),a.status==="uploading"||m.listType!=="picture-card"?(h(),L("div",{key:1,class:g(n(u).be("list","item-info"))},[M("a",{class:g(n(u).be("list","item-name")),onClick:j(i=>m.handlePreview(a),["prevent"])},[_(n(D),{class:g(n(d).m("document"))},{default:P(()=>[_(n(Te))]),_:1},8,["class"]),M("span",{class:g(n(u).be("list","item-file-name")),title:a.name},ae(a.name),11,ut)],10,it),a.status==="uploading"?(h(),U(n(Oe),{key:0,type:m.listType==="picture-card"?"circle":"line","stroke-width":m.listType==="picture-card"?6:2,percentage:Number(a.percentage),style:Be(m.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):b("v-if",!0)],2)):b("v-if",!0),M("label",{class:g(n(u).be("list","item-status-label"))},[m.listType==="text"?(h(),U(n(D),{key:0,class:g([n(d).m("upload-success"),n(d).m("circle-check")])},{default:P(()=>[_(n(De))]),_:1},8,["class"])):["picture-card","picture"].includes(m.listType)?(h(),U(n(D),{key:1,class:g([n(d).m("upload-success"),n(d).m("check")])},{default:P(()=>[_(n(je))]),_:1},8,["class"])):b("v-if",!0)],2),n($)?b("v-if",!0):(h(),U(n(D),{key:2,class:g(n(d).m("close")),onClick:i=>R(a)},{default:P(()=>[_(n(Ae))]),_:2},1032,["class","onClick"])),b(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),b(" This is a bug which needs to be fixed "),b(" TODO: Fix the incorrect navigation interaction "),n($)?b("v-if",!0):(h(),L("i",{key:3,class:g(n(d).m("close-tip"))},ae(n(f)("el.upload.deleteTip")),3)),m.listType==="picture-card"?(h(),L("span",{key:4,class:g(n(u).be("list","item-actions"))},[M("span",{class:g(n(u).be("list","item-preview")),onClick:i=>m.handlePreview(a)},[_(n(D),{class:g(n(d).m("zoom-in"))},{default:P(()=>[_(n(qe))]),_:1},8,["class"])],10,dt),n($)?b("v-if",!0):(h(),L("span",{key:0,class:g(n(u).be("list","item-delete")),onClick:i=>R(a)},[_(n(D),{class:g(n(d).m("delete"))},{default:P(()=>[_(n(Ne))]),_:1},8,["class"])],10,ct))],2)):b("v-if",!0)])],42,lt))),128)),w(m.$slots,"append")]),_:3},8,["class","name"]))}}));var de=I(pt,[["__file","upload-list.vue"]]);const vt=K({disabled:{type:Boolean,default:!1}}),mt={file:t=>ve(t)},yt=["onDrop","onDragover"],$e="ElUploadDrag",gt=O({name:$e}),ht=O(T(S({},gt),{props:vt,emits:mt,setup(t,{emit:s}){const e=Ke(he);e||ee($e,"usage: <el-upload><el-upload-dragger /></el-upload>");const f=H("upload"),u=ye(!1),d=z(),p=v=>{if(d.value)return;u.value=!1,v.stopPropagation();const k=Array.from(v.dataTransfer.files),R=e.accept.value;if(!R){s("file",k);return}const m=k.filter(l=>{const{type:a,name:i}=l,o=i.includes(".")?`.${i.split(".").pop()}`:"",c=a.replace(/\/.*$/,"");return R.split(",").map(r=>r.trim()).filter(r=>r).some(r=>r.startsWith(".")?o===r:/\/\*$/.test(r)?c===r.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(r)?a===r:!1)});s("file",m)},$=()=>{d.value||(u.value=!0)};return(v,k)=>(h(),L("div",{class:g([n(f).b("dragger"),n(f).is("dragover",u.value)]),onDrop:j(p,["prevent"]),onDragover:j($,["prevent"]),onDragleave:k[0]||(k[0]=j(R=>u.value=!1,["prevent"]))},[w(v.$slots,"default")],42,yt))}}));var bt=I(ht,[["__file","upload-dragger.vue"]]);const kt=K(T(S({},ke),{beforeUpload:{type:y(Function),default:E},onRemove:{type:y(Function),default:E},onStart:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}})),$t=["onKeydown"],Et=["name","multiple","accept"],Rt=O({name:"ElUploadContent",inheritAttrs:!1}),wt=O(T(S({},Rt),{props:kt,setup(t,{expose:s}){const e=t,f=H("upload"),u=z(),d=Q({}),p=Q(),$=o=>{if(o.length===0)return;const{autoUpload:c,limit:r,fileList:C,multiple:F,onStart:A,onExceed:V}=e;if(r&&C.length+o.length>r){V(o,C);return}F||(o=o.slice(0,1));for(const X of o){const q=X;q.uid=x(),A(q),c&&v(q)}},v=o=>N(this,null,function*(){if(p.value.value="",!e.beforeUpload)return R(o);let c,r={};try{const F=e.data,A=e.beforeUpload(o);r=ne(e.data)?oe(e.data):e.data,c=yield A,ne(e.data)&&ze(F,r)&&(r=oe(e.data))}catch(F){c=!1}if(c===!1){e.onRemove(o);return}let C=o;c instanceof Blob&&(c instanceof File?C=c:C=new File([c],o.name,{type:o.type})),R(Object.assign(C,{uid:o.uid}),r)}),k=(o,c)=>N(this,null,function*(){return Ve(o)?o(c):o}),R=(o,c)=>N(this,null,function*(){const{headers:r,data:C,method:F,withCredentials:A,name:V,action:X,onProgress:q,onSuccess:Ee,onError:Re,httpRequest:we}=e;try{c=yield k(c!=null?c:C,o)}catch(B){e.onRemove(o);return}const{uid:W}=o,G={headers:r||{},withCredentials:A,file:o,data:c,method:F,filename:V,action:X,onProgress:B=>{q(B,o)},onSuccess:B=>{Ee(B,o),delete d.value[W]},onError:B=>{Re(B,o),delete d.value[W]}},J=we(G);d.value[W]=J,J instanceof Promise&&J.then(G.onSuccess,G.onError)}),m=o=>{const c=o.target.files;c&&$(Array.from(c))},l=()=>{u.value||(p.value.value="",p.value.click())},a=()=>{l()};return s({abort:o=>{Ie(d.value).filter(o?([r])=>String(o.uid)===r:()=>!0).forEach(([r,C])=>{C instanceof XMLHttpRequest&&C.abort(),delete d.value[r]})},upload:v}),(o,c)=>(h(),L("div",{class:g([n(f).b(),n(f).m(o.listType),n(f).is("drag",o.drag)]),tabindex:"0",onClick:l,onKeydown:ge(j(a,["self"]),["enter","space"])},[o.drag?(h(),U(bt,{key:0,disabled:n(u),onFile:$},{default:P(()=>[w(o.$slots,"default")]),_:3},8,["disabled"])):w(o.$slots,"default",{key:1}),M("input",{ref_key:"inputRef",ref:p,class:g(n(f).e("input")),name:o.name,multiple:o.multiple,accept:o.accept,type:"file",onChange:m,onClick:c[0]||(c[0]=j(()=>{},["stop"]))},null,42,Et)],42,$t))}}));var ce=I(wt,[["__file","upload-content.vue"]]);const fe="ElUpload",pe=t=>{var s;(s=t.url)!=null&&s.startsWith("blob:")&&URL.revokeObjectURL(t.url)},Pt=(t,s)=>{const e=Xe(t,"fileList",void 0,{passive:!0}),f=l=>e.value.find(a=>a.uid===l.uid);function u(l){var a;(a=s.value)==null||a.abort(l)}function d(l=["ready","uploading","success","fail"]){e.value=e.value.filter(a=>!l.includes(a.status))}const p=(l,a)=>{const i=f(a);i&&(console.error(l),i.status="fail",e.value.splice(e.value.indexOf(i),1),t.onError(l,i,e.value),t.onChange(i,e.value))},$=(l,a)=>{const i=f(a);i&&(t.onProgress(l,i,e.value),i.status="uploading",i.percentage=Math.round(l.percent))},v=(l,a)=>{const i=f(a);i&&(i.status="success",i.response=l,t.onSuccess(l,i,e.value),t.onChange(i,e.value))},k=l=>{me(l.uid)&&(l.uid=x());const a={name:l.name,percentage:0,status:"ready",size:l.size,raw:l,uid:l.uid};if(t.listType==="picture-card"||t.listType==="picture")try{a.url=URL.createObjectURL(l)}catch(i){We(fe,i.message),t.onError(i,a,e.value)}e.value=[...e.value,a],t.onChange(a,e.value)},R=l=>N(void 0,null,function*(){const a=l instanceof File?f(l):l;a||ee(fe,"file to be removed not found");const i=o=>{u(o);const c=e.value;c.splice(c.indexOf(o),1),t.onRemove(o,c),pe(o)};t.beforeRemove?(yield t.beforeRemove(a,e.value))!==!1&&i(a):i(a)});function m(){e.value.filter(({status:l})=>l==="ready").forEach(({raw:l})=>{var a;return l&&((a=s.value)==null?void 0:a.upload(l))})}return le(()=>t.listType,l=>{l!=="picture-card"&&l!=="picture"||(e.value=e.value.map(a=>{const{raw:i,url:o}=a;if(!o&&i)try{a.url=URL.createObjectURL(i)}catch(c){t.onError(c,a,e.value)}return a}))}),le(e,l=>{for(const a of l)a.uid||(a.uid=x()),a.status||(a.status="success")},{immediate:!0,deep:!0}),{uploadFiles:e,abort:u,clearFiles:d,handleError:p,handleProgress:$,handleStart:k,handleSuccess:v,handleRemove:R,submit:m,revokeFileObjectURL:pe}},Ct=O({name:"ElUpload"}),Ft=O(T(S({},Ct),{props:at,setup(t,{expose:s}){const e=t,f=z(),u=Q(),{abort:d,submit:p,clearFiles:$,uploadFiles:v,handleStart:k,handleError:R,handleRemove:m,handleSuccess:l,handleProgress:a,revokeFileObjectURL:i}=Pt(e,u),o=Z(()=>e.listType==="picture-card"),c=Z(()=>T(S({},e),{fileList:v.value,onStart:k,onProgress:a,onSuccess:l,onError:R,onRemove:m}));return Ge(()=>{v.value.forEach(i)}),Je(he,{accept:Ye(e,"accept")}),s({abort:d,submit:p,clearFiles:$,handleStart:k,handleRemove:m}),(r,C)=>(h(),L("div",null,[n(o)&&r.showFileList?(h(),U(de,{key:0,disabled:n(f),"list-type":r.listType,files:n(v),"handle-preview":r.onPreview,onRemove:n(m)},re({append:P(()=>[_(ce,ie({ref_key:"uploadRef",ref:u},n(c)),{default:P(()=>[r.$slots.trigger?w(r.$slots,"trigger",{key:0}):b("v-if",!0),!r.$slots.trigger&&r.$slots.default?w(r.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)]),_:2},[r.$slots.file?{name:"default",fn:P(({file:F})=>[w(r.$slots,"file",{file:F})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0),!n(o)||n(o)&&!r.showFileList?(h(),U(ce,ie({key:1,ref_key:"uploadRef",ref:u},n(c)),{default:P(()=>[r.$slots.trigger?w(r.$slots,"trigger",{key:0}):b("v-if",!0),!r.$slots.trigger&&r.$slots.default?w(r.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)):b("v-if",!0),r.$slots.trigger?w(r.$slots,"default",{key:2}):b("v-if",!0),w(r.$slots,"tip"),!n(o)&&r.showFileList?(h(),U(de,{key:3,disabled:n(f),"list-type":r.listType,files:n(v),"handle-preview":r.onPreview,onRemove:n(m)},re({_:2},[r.$slots.file?{name:"default",fn:P(({file:F})=>[w(r.$slots,"file",{file:F})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0)]))}}));var _t=I(Ft,[["__file","upload.vue"]]);const Tt=Ze(_t);function Lt(t){return new Promise(function(s){var e=new FileReader;e.readAsDataURL(t),e.onload=function(){s(this.result)}})}function Ot(t){return Lt(t)}function Bt(t){return new Promise(function(s){var e=new FileReader;e.readAsArrayBuffer(t),e.onload=function(){s(this.result)}})}export{Tt as E,Bt as a,Ot as f};
